<p-dialog 
  [(visible)]="visible" 
  [modal]="true" 
  [style]="{width: '600px'}" 
  [header]="assistant ? 'Edit Assistant' : 'Create Assistant'"
  (onHide)="hideDialog()"
  [draggable]="false"
>
  <form [formGroup]="assistantForm" (ngSubmit)="onSubmit()">
    <div class="form-field">
      <label for="name">Name</label>
      <input id="name" type="text" pInputText formControlName="name" />
    </div>

    <div class="form-field">
      <div class="instructions-header">
        <label for="instructions">Instructions</label>
        <p-button 
          icon="pi pi-window-maximize" 
          (onClick)="showInstructionsDialog()"
          [text]="true"
          [rounded]="true"
          styleClass="p-button-sm p-button-secondary"
          pTooltip="Edit in full screen"
        ></p-button>
      </div>
      <textarea
        id="instructions"
        pInputTextarea
        formControlName="instructions"
        [rows]="5"
        [autoResize]="true"
        placeholder="You are a helpful assistant..."
        class="instructions-textarea"
      ></textarea>
    </div>

    <div class="form-field">
      <label for="model">Model</label>
      <p-dropdown
        id="model"
        formControlName="model"
        [options]="availableModels"
        optionLabel="label"
        optionValue="value"
        placeholder="Select a model"
        [style]="{ width: '100%' }"
      ></p-dropdown>
    </div>

    <div class="form-field">
      <label for="temperature">Temperature</label>
      <p-inputNumber
        id="temperature"
        formControlName="temperature"
        [min]="0"
        [max]="2"
        [step]="0.1"
        [showButtons]="true"
        buttonLayout="horizontal"
        spinnerMode="horizontal"
        [style]="{ width: '100%' }"
        decrementButtonClass="p-button-secondary"
        incrementButtonClass="p-button-secondary"
      ></p-inputNumber>
      <small class="helper-text">Controls randomness in responses. Lower values make output more focused and deterministic, higher values make output more creative and varied.</small>
    </div>

    <div class="form-field">
      <label for="top_p">Top P</label>
      <p-inputNumber
        id="top_p"
        formControlName="top_p"
        [min]="0"
        [max]="1"
        [step]="0.1"
        [showButtons]="true"
        buttonLayout="horizontal"
        spinnerMode="horizontal"
        [style]="{ width: '100%' }"
        decrementButtonClass="p-button-secondary"
        incrementButtonClass="p-button-secondary"
      ></p-inputNumber>
      <small class="helper-text">Controls diversity of model outputs. Lower values make output more focused, higher values more creative.</small>
    </div>

    <div class="form-field">
      <label for="response_format">Response Format</label>
      <p-dropdown
        id="response_format"
        [options]="responseFormatOptions"
        formControlName="response_format_type"
        [style]="{ width: '100%' }"
        placeholder="Select response format"
      ></p-dropdown>
      <small class="helper-text">Specifies the format that the assistant should use when responding.</small>
    </div>

    <div class="form-field">
      <label>Input Schemas</label>
      <p-multiSelect
        formControlName="input_schemas"
        [options]="availableSchemas"
        optionLabel="name"
        optionValue="id"
        [style]="{ width: '100%' }"
        placeholder="Select input schemas"
        display="chip"
        (onChange)="onInputSchemasChange()"
      ></p-multiSelect>
      <small class="helper-text">Objects this assistant can accept as input</small>
    </div>

    <div class="form-field">
      <label>Output Schemas</label>
      <p-multiSelect
        formControlName="output_schemas"
        [options]="availableSchemas"
        optionLabel="name"
        optionValue="id"
        [style]="{ width: '100%' }"
        placeholder="Select output schemas"
        display="chip"
        (onChange)="onOutputSchemasChange()"
      ></p-multiSelect>
      <small class="helper-text">Objects this assistant can produce as output</small>
    </div>

    <div class="form-field">
      <app-function-list
        [functions]="functions"
        (functionsChange)="onFunctionsChange($event)"
      ></app-function-list>
    </div>

    <div class="dialog-footer">
      <p-button
        label="Cancel"
        (onClick)="hideDialog()"
        styleClass="p-button-text"
      ></p-button>
      <p-button
        label="Save"
        type="submit"
        [loading]="loading"
      ></p-button>
    </div>
  </form>
</p-dialog>

<p-dialog
  [(visible)]="showFullScreenInstructions"
  [modal]="true"
  [style]="{width: '90vw', height: '90vh'}"
  header="Edit Instructions"
>
  <textarea
    pInputTextarea
    [(ngModel)]="fullScreenInstructions"
    [rows]="20"
    [autoResize]="true"
    class="full-screen-instructions"
  ></textarea>
  <div class="dialog-footer">
    <p-button
      label="Cancel"
      (onClick)="showFullScreenInstructions = false"
      styleClass="p-button-text"
    ></p-button>
    <p-button
      label="Apply"
      (onClick)="applyFullScreenInstructions()"
    ></p-button>
  </div>
</p-dialog>
